/*
Password Strength Indicator using jQuery and XML

By: Bryian Tan (bryian.tan@hotmail.com)

12-01-2015 - v02.00.00
07-23-2012 - v01.03.00
01-17-2011 - v01.02.00
01-12-2011 - v01.01.00

Description:
Password Strength Indicator somewhat similar to ASP.NET AJAX PasswordStrength extender control behavior 
and implemented by using jQuery and XML. The password information is stored in an XML file. 
Sample XML file contents:
<PasswordPolicy>
<Password>
<duration>180</duration> //password age, expired in xxx days
<minLength>14</minLength> //password minimum length
<maxLength>25</maxLength> //password maximum length
<numsLength>2</numsLength> //number of required digits  
<upperLength>1</upperLength> //number of required upper case  
<specialLength>1</specialLength> //number of required special characters 
<barWidth>200</barWidth> //the bar indicator width
<barColor>Green</barColor> //the bar indicator colors
<specialChars>!@#\$%*()_+^&amp;}{:;?.</specialChars> //allowable special characters
 <maxConsecutiveRepeatedChars>1</maxConsecutiveRepeatedChars>
</Password>
</PasswordPolicy>
*/

(function (a) {
    getAbsolutePath = function (b) { return 0 < b.length ? window.location.protocol + "//" + window.location.host + b : window.location.protocol + "//" + window.location.host + "/" }; a.fn.center = function () { this.css("position", "absolute"); this.css("top", (a(window).height() - this.height()) / 2 + a(window).scrollTop() + "px"); this.css("left", (a(window).width() - this.width()) / 2 + a(window).scrollLeft() + "px"); return this }; var t = new function () {
        this.countRegExp = function (b, a) { var c = b.match(a); return c ? c.length : 0 }; this.getStrengthInfo =
        function (a) {
            var l = a.length, c = 0, d = "", e = "", n = "", n = new RegExp("[" + b.specialChars + "]", "g"), h = this.countRegExp(a, /\d/g), f = this.countRegExp(a, /[a-z]/g), g = this.countRegExp(a, /[A-Z]/g), k = this.countRegExp(a, n), r = this.countRegExp(a, /\s/g), q = new RegExp("(.+)\\1{" + b.maxConsecutiveRepeatedChars + ",}", "i"), p = 0; 0 < b.maxConsecutiveRepeatedChars && (p = this.countRegExp(a, q)); e = a.replace(/[a-z]/gi, "") + e.replace(/\d/g, ""); e = e.replace(/\d/g, ""); e = e.replace(n, ""); if (0 < r) return "No spaces!"; if ("" !== e) return "Invalid character: " +
            e; if (l > b.maxLength) return "Password too long!"; if (0 < p) return n = a.match(q), n + " repeated more than " + b.maxConsecutiveRepeatedChars + " times!"; k + g + h + f < b.minLength && (d += b.minLength - (k + g + h + f) + " more characters, "); if (0 == k || 0 == g || 0 == h || 0 == f) d += "At least "; h >= b.numberLength ? h = b.numberLength : d += b.numberLength - h + " more numbers, "; k >= b.specialLength ? k = b.specialLength : d += b.specialLength - k + " more symbol, "; g >= b.upperLength ? g = b.upperLength : d += b.upperLength - g + " Upper case characters, "; c = l - (g + k + h) >= b.minLength - b.numberLength -
            b.specialLength - b.upperLength ? c + (b.minLength - b.numberLength - b.specialLength - b.upperLength) : c + (l - (g + k + h)); c += g + k + h; 0 === f && (1 < c && --c, d += "1 lower case character, "); c == b.minLength && 0 < f && (d = "Strong password!"); return d + ";" + c
        }
    }, b = { minLength: 12, maxLength: 25, specialLength: 1, upperLength: 1, numberLength: 1, barWidth: 200, barColor: "Red", specialChars: "!@#$", metRequirement: !1, useMultipleColors: 0, maxConsecutiveRepeatedChars: 0 }; a.fn.password_strength = function (m) {
        m = a.extend({ appFolderXMLPath: "", passwordPolicyLinkId: "" },
        m); this.metReq = function () { return b.metRequirement }; var l = getAbsolutePath(m.appFolderXMLPath) + "PasswordPolicy.xml"; this.getXMLAbsolutePath = function () { return l }; 0 < m.passwordPolicyLinkId.length && (a("[id=" + m.passwordPolicyLinkId + "]").click(function (b) {
            var d = screen.width / 2 - 175, e = screen.height / 2 - 150; "undefined" !== typeof a.blockUI ? (a.blockUI({ onOverlayClick: a.unblockUI, message: '<br /> <iframe src="' + l + '" height="300px" width="350px" scrolling="no" frameborder="0" id="displayXMLIframe" /><br/>' }), a(".blockUI.blockMsg").center()) :
            (window.open(l, "Password_poplicy", "width=350,height=300,left=" + d + ",top=" + e), b.preventDefault()); return !1
        }), a(window).resize(function () { "undefined" !== typeof a.blockUI && a(".blockUI.blockMsg").center() })); a.ajax({
            type: "GET", url: l, dataType: "xml", success: function (c) {
                a(c).find("Password").each(function () {
                    var d = a(this).find("minLength").text(), c = a(this).find("maxLength").text(), n = a(this).find("numsLength").text(), h = a(this).find("upperLength").text(), f = a(this).find("specialLength").text(), g = a(this).find("barWidth").text(),
                    k = a(this).find("barColor").text(), l = a(this).find("specialChars").text(), m = a(this).find("maxConsecutiveRepeatedChars").text(), p = a(this).find("useMultipleColors").text(); b.minLength = parseInt(d); b.maxLength = parseInt(c); b.specialLength = parseInt(f); b.upperLength = parseInt(h); b.numberLength = parseInt(n); b.barWidth = parseInt(g); b.barColor = k; b.specialChars = l; b.useMultipleColors = p; b.maxConsecutiveRepeatedChars = m
                })
            }
        }); return this.each(function () {
            var c = a("[id='" + this.id + "']").position().left + a("[id='" + this.id +
            "']").width(), d = a("[id='" + this.id + "']").position().top + a("[id='" + this.id + "']").height(), e = a("<span></span>").css({ position: "absolute", top: d - 6, left: c + 15, "font-size": "75%", display: "inline-block", width: b.barWidth + 40 }); a(this).after(e); c = a('<div id="PasswordStrengthBorder"></div><div id="PasswordStrengthBar" class="BarIndicator"></div>').css({ position: "absolute", display: "none" }).eq(0).css({ height: 3, top: d - 16, left: c + 15, "border-style": "solid", "border-width": 1, padding: 2 }).end().eq(1).css({
                height: 5, top: d -
                14, left: c + 17
            }).end(); e.before(c); a(this).keyup(function () {
                var c = a(this).val(); b.metRequirement = !1; if (0 < c.length) {
                    var c = t.getStrengthInfo(c).split(";"), d = 0, f = b.barWidth, g = b.barColor; 1 < c.length && (d = c[1] / b.minLength * f); a("div[id='PasswordStrengthBorder']").css({ display: "inline", width: f }); "1" === b.useMultipleColors && (g = 0 <= parseInt(d) && parseInt(d) <= .33 * f ? "red" : parseInt(d) >= .33 * f && parseInt(d) <= .67 * f ? "blue" : b.barColor); a("div[id='PasswordStrengthBar']").css({ display: "inline", width: d, "background-color": g });
                    -1 !== c[0].lastIndexOf(",") ? e.text(c[0].substring(0, c[0].length - 2)) : e.text(c[0]); d == f && (b.metRequirement = !0)
                } else e.text(""), a("div[id='PasswordStrengthBorder']").css("display", "none"), a("div[id='PasswordStrengthBar']").css("display", "none")
            })
        })
    }
})(jQuery);