/*
Password Strength Indicator using jQuery and XML

By: Bryian Tan (bryian.tan@hotmail.com)

11-22-2016 - v02.01.00 //check keyboard sequence
12-01-2015 - v02.00.00
07-23-2012 - v01.03.00
01-17-2011 - v01.02.00
01-12-2011 - v01.01.00

Description:
Password Strength Indicator somewhat similar to ASP.NET AJAX PasswordStrength extender control behavior 
and implemented by using jQuery and XML. The password information is stored in an XML file. 
Sample XML file contents:
<PasswordPolicy>
<Password>
<duration>180</duration> //password age, expired in xxx days
<minLength>14</minLength> //password minimum length
<maxLength>25</maxLength> //password maximum length
<numsLength>2</numsLength> //number of required digits  
<upperLength>1</upperLength> //number of required upper case  
<specialLength>1</specialLength> //number of required special characters 
<barWidth>200</barWidth> //the bar indicator width
<barColor>Green</barColor> //the bar indicator colors
<specialChars>!@#\$%*()_+^&amp;}{:;?.</specialChars> //allowable special characters
 <maxConsecutiveRepeatedChars>1</maxConsecutiveRepeatedChars>
</Password>
</PasswordPolicy>
*/
!function (a) { getAbsolutePath = function (a) { return a.length > 0 ? window.location.protocol + "//" + window.location.host + a : window.location.protocol + "//" + window.location.host + "/" }, a.fn.center = function () { return this.css("position", "absolute"), this.css("top", (a(window).height() - this.height()) / 2 + a(window).scrollTop() + "px"), this.css("left", (a(window).width() - this.width()) / 2 + a(window).scrollLeft() + "px"), this }; var b = new function () { this.countRegExp = function (a, b) { var c = a.match(b); return c ? c.length : 0 }, this.getKeyboardSequenceChar = function (a) { var b = c.maxKeyboardSequence + 1, d = c.keyboardSequenceCharacters, e = 0, f = 0; if (a.length >= b) for (; e < a.length;) { e = f + b; var g = a.substr(f, b); if (d.indexOf(g.toLowerCase()) >= 0) return g; f++ } return "" }, this.getStrengthInfo = function (a) { var b = a.length, d = 0, e = "", f = "", g = "", h = new RegExp("[" + c.specialChars + "]", "g"), i = this.countRegExp(a, /\d/g), j = this.countRegExp(a, /[a-z]/g), k = this.countRegExp(a, /[A-Z]/g), l = this.countRegExp(a, h), m = this.countRegExp(a, /\s/g), n = this.getKeyboardSequenceChar(a), o = new RegExp("(.+)\\1{" + c.maxConsecutiveRepeatedChars + ",}", "i"), p = 0; return c.maxConsecutiveRepeatedChars > 0 && (p = this.countRegExp(a, o)), f = a.replace(/[a-z]/gi, "") + f.replace(/\d/g, ""), f = f.replace(/\d/g, ""), f = f.replace(h, ""), m > 0 ? "No spaces!" : "" !== n ? "Keyboard sequence characters not allow: " + n : "" !== f ? "Invalid character: " + f : b > c.maxLength ? "Password too long!" : p > 0 ? (g = a.match(o), g + " repeated more than " + c.maxConsecutiveRepeatedChars + " times!") : (l + k + i + j < c.minLength && (e += c.minLength - (l + k + i + j) + " more characters, "), 0 != l && 0 != k && 0 != i && 0 != j || (e += "At least "), i >= c.numberLength ? i = c.numberLength : e += c.numberLength - i + " more numbers, ", l >= c.specialLength ? l = c.specialLength : e += c.specialLength - l + " more symbol, ", k >= c.upperLength ? k = c.upperLength : e += c.upperLength - k + " Upper case characters, ", d += b - (k + l + i) >= c.minLength - c.numberLength - c.specialLength - c.upperLength ? c.minLength - c.numberLength - c.specialLength - c.upperLength : b - (k + l + i), d += k + l + i, 0 === j && (d > 1 && (d -= 1), e += "1 lower case character, "), d == c.minLength && j > 0 && (e = "Strong password!"), e + ";" + d) } }, c = { minLength: 12, maxLength: 25, specialLength: 1, upperLength: 1, numberLength: 1, barWidth: 200, barColor: "Red", specialChars: "!@#$", metRequirement: !1, useMultipleColors: 0, maxConsecutiveRepeatedChars: 0, maxKeyboardSequence: 2, keyboardSequenceCharacters: "123456789" }; a.fn.password_strength = function (d) { var e = a.extend({ appFolderXMLPath: "", passwordPolicyLinkId: "" }, d); this.metReq = function () { return c.metRequirement }; var f = getAbsolutePath(e.appFolderXMLPath) + "PasswordPolicy.xml"; return this.getXMLAbsolutePath = function () { return f }, e.passwordPolicyLinkId.length > 0 && (a("[id=" + e.passwordPolicyLinkId + "]").click(function (b) { var c = 350, d = 300, e = screen.width / 2 - c / 2, g = screen.height / 2 - d / 2; return "undefined" != typeof a.blockUI ? (a.blockUI({ onOverlayClick: a.unblockUI, message: '<br /> <iframe src="' + f + '" height="370px" width="370px" scrolling="no" frameborder="0" id="displayXMLIframe" /><br/>' }), a(".blockUI.blockMsg").center()) : (window.open(f, "Password_poplicy", "width=" + c + ",height=" + d + ",left=" + e + ",top=" + g), b.preventDefault()), !1 }), a(window).resize(function () { "undefined" != typeof a.blockUI && a(".blockUI.blockMsg").center() })), a.ajax({ type: "GET", url: f, dataType: "xml", success: function (b) { a(b).find("Password").each(function () { var b = a(this).find("minLength").text(), d = a(this).find("maxLength").text(), e = a(this).find("numsLength").text(), f = a(this).find("upperLength").text(), g = a(this).find("specialLength").text(), h = a(this).find("barWidth").text(), i = a(this).find("barColor").text(), j = a(this).find("specialChars").text(), k = a(this).find("maxConsecutiveRepeatedChars").text(), l = a(this).find("maxKeyboardSequence").text(), m = a(this).find("keyboardSequenceCharacters").text(), n = a(this).find("useMultipleColors").text(); c.minLength = parseInt(b), c.maxLength = parseInt(d), c.specialLength = parseInt(g), c.upperLength = parseInt(f), c.numberLength = parseInt(e), c.barWidth = parseInt(h), c.barColor = i, c.specialChars = j, c.useMultipleColors = n, c.maxConsecutiveRepeatedChars = k, c.maxKeyboardSequence = parseInt(l), c.keyboardSequenceCharacters = m }) } }), this.each(function () { var d = a("[id='" + this.id + "']").position().left + a("[id='" + this.id + "']").width() + parseInt(a("[id='" + this.id + "']").css("padding-left").replace("px", "")), e = a("[id='" + this.id + "']").position().top + a("[id='" + this.id + "']").height(), f = a("<span></span>").css({ position: "absolute", top: e - 6, left: d + 15, "font-size": "75%", display: "inline-block", width: c.barWidth + 40 }); a(this).after(f); var g = a('<div id="PasswordStrengthBorder"></div><div id="PasswordStrengthBar" class="BarIndicator"></div>').css({ position: "absolute", display: "none" }).eq(0).css({ height: 3, top: e - 16, left: d + 15, "border-style": "solid", "border-width": 1, padding: 2, "box-sizing": "unset" }).end().eq(1).css({ height: 5, top: e - 14, left: d + 17 }).end(); f.before(g), a(this).keyup(function () { var d = a(this).val(); if (c.metRequirement = !1, d.length > 0) { var e = b.getStrengthInfo(d), g = e.split(";"), h = 0, i = c.barWidth, j = c.barColor; g.length > 1 && (h = g[1] / c.minLength * i), a("div[id='PasswordStrengthBorder']").css({ display: "inline", width: i }), "1" === c.useMultipleColors && (j = parseInt(h) >= 0 && parseInt(h) <= .33 * i ? "red" : parseInt(h) >= .33 * i && parseInt(h) <= .67 * i ? "blue" : c.barColor), a("div[id='PasswordStrengthBar']").css({ display: "inline", width: h, "background-color": j }), g[0].lastIndexOf(",") !== -1 ? f.text(g[0].substring(0, g[0].length - 2)) : f.text(g[0]), h == i && (c.metRequirement = !0) } else f.text(""), a("div[id='PasswordStrengthBorder']").css("display", "none"), a("div[id='PasswordStrengthBar']").css("display", "none") }) }) } }(jQuery);